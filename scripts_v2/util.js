const CONTENT = {
	
    "Trading": {	
		
		

	  "Preservation of capital" : [
	  
        {
          id: "pc-aug25",
          title: "August 2025",
          summary: "Preserve capital",
          html: `
          <p class="text-center"> 	You are not getting your priorities right</p>
		  <p>
			This quote should act as a constant alert to recalibrate and mean-revert yourself to your ultimate objective. If my life path is a Hull-White model, I probably have a stochastic mean reversion parameters and it happen to be very low right now because even with a huge gap between the forward curve (expected as of the 2010s days) and the current spot, there is a huge gap and is just not been reverting. But like all stochastic models the probability of hitting a tail risk event is either from a highly volatile move (say high mean reversion), or with ... time! Hence worth to be hopeful because a change is probabilstically always in our favour.
		  </p>

	      <p>
			 Sitting and typing at the moment present me with the enjoyment of spending time on my own, and cultivating hope and higher purpose which all adds up to my pool of joy (Although I should be handling admin tasks for my family *laugh*). Still, allocation of my leisure hours to heighten ability to endure pain and torture (through sports, for exmaple) should undoubtly be a higher priority and strengthen oneself. A scenario is given a optimistic and positive sportsman or military man with my body and my background (or my cards), I trust they could play it very well. There is never an excuse to not try. Never! 
		  </p>
          `
        },{
          id: "pc-sep2025",
          title: "September 2025",
          summary: "September Write-up",
          html: `
			<p><b>
			Be serious about it </b></p><p> 
			Whether is playing counter-strike, presenting in a meeting, or gambling, or trading - having the right (i) mentality, (ii) attitude and (iii) treating your work your craft with a <b>serious</b> mentality on is important.
			Just like I learn in counter-strike today (25.09.13) - being serious in your craft of counter-strike helps you be top scorer and top frag, and eliminates emotional content and get on with it. When you were told to clean your house, the 'confidence' bit do not come into play. And emotional content really robs your success. 
			So be serious like you are the pilot of a flight or captain of the ship, you are in the cockpit, pushing the button and leading your ship to succeed: like any pro-gamer setting up their gears in tournaments, traders reading up the overnight events and getting their trading environment set up, sales moisening up and prepare their pitchbook, and leader coming up to the stage and ready to launch and attack. Predator instinct is super important because missing a meal means life-and-death in the animal kingdom, and is built into the human instinct, doing sloppy or lazy work is a herbivorous tactic that result in suffering and pain. 
			</p>
			
			<p><b>
			Smart-risk taker</b></p><p> 
			Is 5 seconds into a T round and you are outside A door - your memory tells you that an AWPer will chuck a fire bomb and then place an AWP. You either extinguish the fire with a smoke or wait for the fire to die out. But what's next? You stood outside A door still, (virtually) shaking your legs because you do not want to be AWPed, so you go to another spot. But you are then NOT a risk taker. Whilst rushing in is a reckless crazy person (there is no courage point nor smart point, is as bad as former). So smart-risk taker is one where the odds are certainly not fully in your favour but you execute this odd in the best way (just like in a Pokemon TCG Pocket round where it could be risky to not heal your evolved Eevee, risk getting hit to 10hp or 0hp damage depending on if they have +10 damage, only then to leave the Eevee trainer card to boost better move the next turn and win the game). </p>
			<p>
		    <ul class="muted small">
				<li>Risk taker mentality - not reckless, not fuck-it, not give-up, not DIEEEEEE!, none of those. Is abit like let's walk up to the group of strangers, let's ski down the slope, push yourself a little and action. This is going against the current a little, be brave a little, be proud a little, be stepping out of the usual a little. Is not stand outside A-door. Is practice not outside the A-door. Is practice the new and unfamiliar and having that reward behind the curtain</li>
				<li>Smart - not rocket science, not research analyst. Is rationalise the idea, abit like Charlie Kirk, not a PhD Philosophy A Grade, not overthink, but business is about seeing an angle, the <i>main point</i>, the 一針見血. Seeing a pattern is not writing a 10,000 dissertation in 6-months, is about seeing the vitual green-dotted line in 秋名（雪） and drift like a orange beeping light</li>
			</ul>
			
			So what is the smart move to handle this A-door situation? ChatGPT said pop-flash and rotate. The 'risk-taker' rulebook would include a 'rotation', i.e. knowing when, how, where, why to cut loss and whether to rotate (to opposite direction). The point is, point 1 and 2 goes hand-in-hand. If you see something feels right, you need to convince yourself (not blindly sell yourself but knowing what works). For example often time chart (i.e. historical FOMO trades basically, and that's why history is pretty toxic lol) points to a steepner trade idea - "Damn of course curve will steepen, it was freaking 0bps and inverted" (But no you actually have no clue), then saying (A) donald trump cut rates and borrowing costs go up so people dumping 30-year bond, and (B) what if this is over priced-in OR what if long-term bond rally due to another driver, where (A) and (B) works all the time (the main story and the counter story), is 100% time (with every trade you can say that). So you need a view and the view comes with well document and accounted historical analysis. 		</p>
			<p>

			To repeat, a lazy person is one where things been sloppy and there is a lazy mindset (it's too hard, it's never possible, it's too much time, the world's fault) and suddenly there is a second where the person thinks "oh I need a big change" but with the above caveats ("too late", "need it quick") so mindlessly take the easiest option (e.g. suddenly put a big trade, or go to double-black ski lift), basically again the "risk-taking" is actually not a change but another careless, lazy act. And hence set to fail or disaster. We are talking about a plan, a commitment, a routine, for many years, for as long as the career or vocation will last, to keep "practice, push, practice, push" - just like how the ski instructor taught us how to ski, you push yourself to harder cliff until you no longer fails (and failure in trading does not mean 100% loss, it means preservation of capital again!), then you do something harder (define it, not necessarily more capital). In fixed income trading T-bill and playing on the sub-1 year interest rates is 'easier' but is risky. Then you have 2-year, 5-year, 7-year, 10-year and finally the 20s, 30s, each is a different beast require you to tackle (more like POkemon in that sense, you start battling Onix which was super tough if you recall, and then before you know it you were battling the Dragonite gym fighter (I am talking about when you were 12 year old playing Pocket Monsters Red). So no, do not be reckless, which is equivalent lazy
			
			</p>
			
			

			
			<p><b>
			Reading list/Literature Review</b></p><p> 
			Despite an increased skeptism in contemporary method of tertiary education, I still reckon there were useful takeways (And really one should spend another session reflecting the tertiary education takeaways). But one example is the constant reminder that in bringing in an idea, a thorough literature review is required and here we go through some of the useful readings a individual in learning the ropes of preserving capital can pursue:
			</p><p>
		    <ul class="muted small">
				<li>Fixed income research paper - contains primer or trading idea by rates strategists or fixed income research team to tackle ideas, how they pitch a driver and then rationalising it. This kind of framework can really be replicated if one needs to be serious in rates trading. Could be old one or new one. Recently I love RESROUNDUP from Bloomberg, BI/FED/USTY are good screens to capture activities (BI also have technical analysis on rates), occasionally the MOVE index are to watch out for, surveys/positionings (Cash, GovPX, Futures), Money market wraps, new researches like Rates Spark (ING), European Sunrise (Commerzbank), Philip Maley (Rabobank) and BMO Capital Markets ones are quite good, Podcasts from NAB are really quality. And even NatWest podcasts are great to see how people are trained to think. There are many researchers which contribute and framework is really important.</li>
				<li>Smart money/hedge fund - reading sample trades or releases (like the Eliott-Wave headlines) that may provoke thoughts.</li>
				<li>Fed speak - really understanding and reading the Federal Reserve speakers and watching Fed members like you watch news on Mirror (yep.. the pop group) would be right way to go. The ECB, the IMF, the BIS, the Fed NY or St Louis, BOE, Bank of France etc, many central banks are also investing alot of resource to research the markets. Learn from those!</li>
				<li>News papers - Economist and FT and WSJ are the go-to. Although they are premium materials. How about BBC? Sometimes the smartest trades and smartest build-up are starting from really public information, or if not they are very private, getting access to the 'best' news sources may not mean edge.</li>
				<li>Economists and Twitters - Fed watcher, Krugman, Mohamed A El-Erain, retired economic advisers and twitting fund managers and economists could inspire what to watch.</li>
            </ul>
			</p>
			
			<p><b>
			Stopping time and stopping levels, and comfort zone</b></p><p> 
			Next trade we should really introduce 3 concepts: stopping time, stopping levels and comfort zone. What are the sins?:
			</p><p>
		    <ul class="muted small">
				<li><b>Stopping time</b> - holding a losing position for more than 2 weeks, or holding a winning position and not deciding whether to build onto it or to take profit</li>
				<li><b>Stopping levels</b> - no idea where to FORCIBLY take stop loss or take profit</li>
				<li><b>Comfort zone</b> - are the levels are truly within comfort level?</li>
            </ul>
			</p><p>
			Note prior to NFP, CPI or FOMC, there is a more quiet period where people may take profit, stop adding risk or unwind risk. Do note that expecting violent move (before the storm) is not rational. Tomorrow night will be FOMC (2am HKT), at least have the old framework ready:
			</p>
			<p>
		    <ul class="muted small">
				<li><b>Fundamental</b></li>
				  <li style="list-style-type:none">
					<ul>
					  <li><b>Steepening</b> - dovish rate cut with statement pointing to worsening labour market whilst CPI are under control will lead to further rate cut priced in as FOMC sort of move that bias to employment concerns whilst the acceptance of a higher inflation will definitely give way to selling pressure around the long ends</li>
					  <li><b>Flattening</b> - hawkish comments coming in of no additional rate cut may mean no more inflation carelessness should be priced in - Fed will stick by its guns and remain hawkish amid heighten political pressure from the administration. Meanwhile the inflation reassurance continue to add back confidence into the financial system so money flow back into the dollars given Fed's commitment to enhance confidence in Fed's mandate of maintaining price stability</li>
					</ul>
				  </li>
				<li><b>Technical</b></li>
				  <li style="list-style-type:none">
					<ul>
					  <li><b>Steepening</b> - Daily charts still show going up so there has not yet been a correction. Momentum to go up sort of slow and is not looking like is going up more and more. 5s30s at 100bps may still be seen as a relative steal given term premium and long datedness there should be more weakness.</li>
					  <li><b>Flattening</b> - Extension of that weak momentum may continue and pricing about 80bps is justified. Early 22s to 25s the 5s30s are sub 50bps as elevated rates with long-end rate cut and price stability and expected growth impact is giving off this flatter curve vibe. As rate cut and more inflation and more growth priced in, couple with equity (stock growth) and gold (inflation protection), the 5s30s on this basis should go up. Above 100bps seems to be more of a norm when Fed is to run an accomodating monetary policy. Given lack of evidence of an escalated urgency, above 100bps could be hard although i feel the market could be opened to this idea. Weak labour report and the rejection of a 50bps in September I think could be seen as sufficient reasons as too why the 100bps mark could still be relevant.</li>
					</ul>
				  </li>
            </ul>
			In conclusion I do not feel there is a material departure from 100bps naturally. Wrong policy would be what can bring a more volatile ending to the 5s30s, with too loose (e.g. 2 cuts or dovish Fed) signal a much steeper curve as worries build-up and too tight (e.g. no cut or hawkish Fed) a much flatter curve. It comes down to the Fed statement to put on a trade in my opinion and really depends on the 'vibe' that the Fed is sounding to put on a trade.
			</p>
			
			
			
			<p><b>
			Allocation and speed (21Sep)</b></p><p>

			Yes we talked about many of the buyside institutions are (A) specific class focus, (B) public sector or slow acting mutual fund, and how does the market turn like a hedge fund whenever there is a news and how to market-maker sort of gauge the market? </p><p>
			First (A) if there is only equity and bond, equity having an interest to increase risk whilst bond has interest to offload risk would give the same effect as "market shift bond to equity" - doesn't matter if it's a multi-asset PM or not, looking individual market or managing cross-asset should take same action given the same asset-class/cash combination (that is to say if long-only equity do not want to long equity they just hold cash or cash-like asset like T-bill. which by the way these extra demand of cash got to go somewhere like... gold?)</p><p>
			Second, think about the securities market like pokemon card or lego, the market always adjust super quickly afterall the stores are run by the market makers, so if say suddenly they said they will stop printing a specific booster set, they will jack up the price instantly. Or if they release a news that says "actually this ninjago castle they will only make 10 boxes" (a supply-side restriction), the market maker jack up the price instantly. The supply/demand expectation leads to quick move in prices as they have to ensure that they are able to adjust the "mid" correctly so they can keep their bid/offer flow-based (or risk-free in a sense) PnL flat. There could be some sense in where it should stop, for example z-score on a given day should make sensible guideline as to how a news story should look like, i.e. CPI worse than forecast is not a 3 z-score moves on a day, although could be in a week if it materially shift the landscape of rate hike or cut. </p><p>
			Like I say some exercise one can do is to</p><p><ul>
				<li>Break down every week what has happened, which guys called it right and are the drivers aligned? Learn from that</li>				
				<li>Which guys called the right move at start of a trend and what did they do well?</li>				
				<li>Have a ready on allocation paper and learn of asset-allocation</li>
			</ul>
			</p>
          
			
			
			<p><b>
			(C)</b></p><p> 
			...
			</p>
          `
			
			
			
		}
	  ]
    },

    "Life": {
      "Thoughts": [
        {
          id: "life-id259a",
          title: "Q3 25 Thoughts",
          summary: "Q3 25 Thoughts",
          html: `
		  <p>
		  <b>Intro</b>
		  </p> 
		 
		  <p>
		  Staring into the eyes of my year-and-a-half old boy, I realise that no two moments are identical. His smile truly makes me want to ensure that his life will be ok. And most of it is mindset, and being around with people of good mindset. And the right mindset is always having a "That's ok" mentality. Facing adversity or when one have to question themselves, one needs to know that it is ok. There is no need to change, doing better or self-improvement is a luxury, just like having the latest Nintendo Switch or something. The perfect individual pitched by some of the best sellers down in the bookshop asile is imaginery, all humans are flawed, and no, no authors truly about you, they are truly for their bank account and their insecurity of running out people who subscribe to their Podcast, like their comments or befriend with them. So do not let 'society' put you down because (1) they do not care, (2) having 'good' access to society is a add-on service that could come at a cost for some. [It is late (12:02am) but I am glad to start this upcoming project]
		  </p> 
		  
		  <p>
		  Again - Priorities. No one's priority should be about reading self-help book or be with people you do not geuinely love to be with. No one priority should be wasted of thing which neither yield short-term or long-term healty, benefit or happiness. Please re-align. You do not need a "Trading Cockpit", you need rather a "life improving cockpit"
		  </p> 
		  
		  <p>
		  <b>Suffering is Joy, Torture yourself!</b>
		  </p>
		  
		  <p>
		  There are other ways to put it : "No pain no gain", "Sweat is fat leaving the body" etc. But really these more positive version do not address the idea that "suffering" is not a painful or unhappy thing, it is a neutral phenomenon to life. Whilst "torturing" means you intentionally "add weights" to the barbell, you push yourself and pinch yourself. Because like a friend of mine said "human are inheretently lazy", that you will find yourself giving up before reaching 160KCal burnt within 20 minutes. You actually have to pinch yourself, you actually have to be your own PT, you actually have to feel "yes today there is pain and suffering I am more complete, that means I am trained" and this applies both emotionally and physically. 
		  </p>
			
		  <p>
		  <b>Relations with others</b>
		  </p>
		  <p> 
			Overtime my perception of friendship changes. I am not a person who is designed to have many friends, and I would said labels like "socially awkward" do stick with me. When I stumble across more recent YouTube vidoes of Tony Leung describing himself as having social anxiety, I felt represented, that established successful people can openly say they are anxious in social events. I feel is coming down on how person is raised. Being judged by others, and constantly performing reactions or anticipation of opinions and judgements is a tiring business for me. I truly think there are people you can get along well. And that people tend to get along for better at younger age. People are more similar (same school, similar hobbies), and then comes more adult-like issue (more like young adults issue) which start to create groups, and later at work where social status of individual sort of diverge. I would love the idea of people looking pass a lot of things and just enjoy a meal and bullshit and no hard feelings but that's what <b>you</b> want, this match <b>your</b> social ideal, but other people social ideal is not: some want destruction, some want their values to be agreed, some want to be loved for who they are, some want to be a leader etc, and as long as there is no overlap (mostly me because I wish for a type that is hang-out-able) then it can be a long tug-of-war, and if <b>you</b> mistakenly think there is a turning point, then it will be a huge waste of time. Understand that there is no turning point and people are different and no everyone can bond at all stages (even a pair of friends can start hating each other, become best buddy, then do not talk to each other again). People are also <b>for themselves</b>, meaning if you tell people your family matters and something happen that make you feel sad, only you feel sad, no one can feel how you felt and expecting people to feel you is over the top. Friendship is a tricky subject for me, I used to think who and who is my friend, and then I found out less and less best friend, and it hit my confidence because I feel I am not the other person's best friend. It started off with how the word "best friend" exist. There is no forever "best friend", and I can be sure that there exist best friends who keep being best for the sake of having best friends. Or that there is deep down non-overlapping part. People at 40s and 50s start to loose real best friends and they only have families. Friends for older people are generally people who can mutually benefit from socialising because this is what people relationship are like. There are people in sales who keep good relationship with others at best, who can take themselves lightly, who can take things lightly, laugh it off, they have friends, but they also do not get over emotional. Whilst I do get emotional, and you love alone time (like now). I do not see friend as a necessity or luxury, it can be very loose.
			</p>
			
			
		  <p></p>`
        },
		
        {
          id: "life-energy",
          title: "Energy > Time",
          summary: "Guard sleep, nutrition, movement; schedule hard work in peak energy blocks.",
          html: `<p>Time is fixed; energy is variable. Protect 7–8h sleep, sunlight AM, protein-forward meals, and a daily walk. Batch meetings; leave creative blocks intact.</p>`
        },
        {
          id: "life-weekly-review",
          title: "Weekly Review (30–45m)",
          summary: "Close loops, plan experiments, set constraints.",
          html: `<ol><li>Inbox to zero</li><li>Review goals</li><li>Pick 1–2 experiments</li><li>Block calendar</li><li>Write a short strategy note</li></ol>`
        },
      ]
    },
    "Not-in-use": {
		
      "Not-in-use-prob": [
        {
          id: "math-bayes",
          title: "Bayes’ Theorem (Trading Lens)",
          summary: "Update priors with new signals; watch base rates.",
          html: `<p><code>P(A|B) = P(B|A)P(A)/P(B)</code>. In markets, treat signals as <em>noisy</em>. Calibrate false positives/negatives using out-of-sample tests.</p>`
        },
        {
          id: "math-ev",
          title: "Expected Value & Kelly (Lite)",
          summary: "Sizing under uncertainty; volatility caveats.",
          html: `<p>EV = Σ p_i x_i. Kelly <em>fraction</em> is fragile to estimation error; consider half/quarter Kelly.</p>`
        },
		
        {
          id: "math-eigen",
          title: "Eigen Stuff in Risk",
          summary: "PCA for curve moves; beware regime shifts.",
          html: `<p>PCA extracts principal modes (level, slope, curvature). Refit often; rolling windows, shrinkage, and robust scaling help.</p>`
        }
      ],
	        "Not-in-use-fires": [
        {
          id: "fi-treasury-net-issuances",
          title: "Treasury Net Issuances",
          summary: "Compute net supply and interpret its macro/market impact.",
          html: `
            <p><strong>Definition.</strong> Net issuance ≈ <code>Gross Issuance − Redemptions − Buybacks</code>. For a specific period (e.g., monthly/quarterly), you can sum by tenor or bill/note/bond buckets.</p>
            <ol>
              <li><strong>Collect</strong> auction calendars & results (CUSIPs, sizes, tenors) + maturity schedules.</li>
              <li><strong>Aggregate</strong> gross issuance for the period; sum <em>redemptions</em> maturing in the same period; subtract any <em>buybacks</em>.</li>
              <li><strong>Slice</strong> by bills vs. coupons; map to duration buckets if needed.</li>
              <li><strong>Interpretation</strong>: higher net supply (esp. coupons) can steepen curves and pressure risk assets if duration supply rises absent offsetting demand (e.g., QE).</li>
            </ol>
            <p class="mb-1"><strong>Example (toy numbers):</strong></p>
            <pre class="mb-2">Gross: $1,000bn | Redemptions: $750bn | Buybacks: $0bn → Net ≈ $250bn</pre>
            <p class="mb-0">Context matters: bill-heavy net supply impacts front-end funding; coupon-heavy shifts duration and term premium.</p>
          `
        },
        {
          id: "fi-yield-curve-primer",
          title: "Yield Curve Primer",
          summary: "Shapes (normal, flat, inverted), drivers, and typical signals.",
          html: `
            <ul>
              <li><strong>Shapes:</strong> Normal (growth), Flat (transition), Inverted (tight policy/recession risk).</li>
              <li><strong>Drivers:</strong> Policy rate path, term premium, supply/demand, inflation expectations.</li>
              <li><strong>Watch:</strong> 2s10s, 5s30s, OIS vs. UST, breakevens vs. reals.</li>
            </ul>
          `
        },
        {
          id: "fi-duration-convexity",
          title: "Duration & Convexity (Quick Ref)",
          summary: "Key formulas and when to trust linear DV01.",
          html: `
            <p>Approx P/L ≈ <code>-Duration × Δy + 0.5 × Convexity × (Δy)^2</code>. For large moves, include convexity; for callable/ MBS, be mindful of negative convexity.</p>
          `
        },
        {
          id: "macro-liquidity-dash",
          title: "Liquidity Dashboard (Concept)",
          summary: "TGA, RRP, reserves, issuance mix → risk impulse.",
          html: `
            <p>Track Treasury General Account, RRP balances, bank reserves, and coupon vs. bill mix. Shifts between RRP ↔ banking system often map to risk appetite.</p>
          `
        }
      ],
      "Not-in-use-ta": [
        {
          id: "ta-breakout-checklist",
          title: "Breakout Checklist",
          summary: "Structure, volume, context, and risk plan.",
          html: `
            <ul>
              <li>Structure: compression/coil, volatility contraction, clean level.</li>
              <li>Volume: expansion on break, no overhead supply.</li>
              <li>Context: trend alignment across timeframes.</li>
              <li>Risk: invalidate level, position sizing, slippage plan.</li>
            </ul>
          `
        },
        {
          id: "ta-r-multiples",
          title: "R-Multiples & Position Sizing",
          summary: "Turn setups into distribution-aware bets.",
          html: `
            <p>Define stop (1R). Expectancy <code>E = p×R_w − (1−p)×R_l</code>. Focus on <em>edge</em> + <em>variance control</em> (size, correlation).</p>
          `
        }
      ]
    }
  };

  /*****************************************************************
   * 2) RENDERING HELPERS
   *****************************************************************/
  const $B = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const enc = encodeURIComponent;
  const dec = decodeURIComponent;

  function makeId(str) {
    return String(str).toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");
  }

  // EC 2501 ::  
  // :: ${} is like f'string in Python, enc() turns spaces to %20
  // :: function turns categories to a string (or a 'hash'(#)' string) which suffixes the URL
  function hashFor(cat, sub, sectionId="") {
    // Format: #cat=Trading&sub=Fixed%20Income&sec=fi-treasury-net-issuances
    const base = `#cat=${enc(cat)}&sub=${enc(sub)}`;
    return sectionId ? `${base}&sec=${enc(sectionId)}` : base;
  }
  // EC 2501 :: split the string after "#" in the URL to look up params
  function parseHash() {
    const h = location.hash.slice(1);
    const params = new URLSearchParams(h);
    const cat = params.get('cat') ? dec(params.get('cat')) : null;
    const sub = params.get('sub') ? dec(params.get('sub')) : null;
    const sec = params.get('sec') ? dec(params.get('sec')) : null;
    return { cat, sub, sec };
  }

  /*****************************************************************
   * 3) SIDEBAR RENDERING
   *****************************************************************/
  function renderSidebar(data) {
    const host = document.getElementById('sidebarContent');
    host.innerHTML = '';
	
	  let homeLink = document.createElement('a');
	  homeLink.href = '#intro';
	  homeLink.className = 'list-group-item';  
	  homeLink.textContent = 'Home';//'🏠 Home';
	  host.appendChild(homeLink);
	  
    Object.entries(data).forEach(([topic, subtopics], i) => {
      const topicId = `topic-${makeId(topic)}-${i}`;
      const accId = `acc-${topicId}`;

      const header = document.createElement('div');
      header.className = 'section-title';
      header.textContent = topic;
      host.appendChild(header);

      const list = document.createElement('div');
      list.className = 'list-group list-group-flush';

      Object.keys(subtopics).forEach((sub, j) => {
        const item = document.createElement('a');
        item.href = hashFor(topic, sub);
        item.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
        item.innerHTML = `<span>${sub}</span><span class="badge bg-secondary">${subtopics[sub].length}</span>`;
        list.appendChild(item);
      });

      host.appendChild(list);
    });
  }

  function highlightActive(cat, sub) {
    $$('#sidebarContent a.list-group-item').forEach(a => a.classList.remove('active'));
    const selector = `a[href^="${CSS.escape(hashFor(cat, sub))}"]`;
    const link = $B(selector, $B('#sidebarContent'));
    if (link) link.classList.add('active');
  }

  /*****************************************************************
   * 4) MAIN CONTENT RENDERING
   *****************************************************************/
  function renderMain(cat, sub, sec) {
	  	document.getElementById('clearMemoryBtn').addEventListener('click', () => {
  clearLast();
});
    const title = document.getElementById('pageTitle');
    const intro = document.getElementById('intro');
    const host = document.getElementById('content');

    if (!cat || !sub || !CONTENT[cat] || !CONTENT[cat][sub]) {
      title.textContent = 'Welcome';
      intro.style.display = '';
      host.innerHTML = '';
      return;
    }

    title.textContent = `${cat} / ${sub}`;
    intro.style.display = 'none';

    const cards = CONTENT[cat][sub];
    host.innerHTML = '';

    cards.forEach(item => {
      const card = document.createElement('div');
      card.className = 'card shadow-sm mb-3';
      card.dataset.title = item.title.toLowerCase();
      card.dataset.text = (item.summary + ' ' + item.html.replace(/<[^>]+>/g, ' ')).toLowerCase();

      const anchor = hashFor(cat, sub, item.id);
      card.innerHTML = `
        <div class="card-header d-flex align-items-center justify-content-between">
          <h2 class="h6 mb-0">${item.title}</h2>
          <a href="${anchor}" class="small text-decoration-none">#</a>
        </div>
        <div class="card-body">
          ${item.summary ? `<p class="muted small mb-2 truncate-2">${item.summary}</p>` : ''}
          <div>${item.html}</div>
        </div>
      `;
      host.appendChild(card);
    });

    // Scroll to section if specified
    if (sec) {
      const target = $B(`a[href$="sec=${enc(sec)}"]`);
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
  }

  /*****************************************************************
   * 5) FILTERING + COPY LINK + STATE
   *****************************************************************/
  function attachFiltering() {
    const input = document.getElementById('search');
    input.addEventListener('input', () => {
      const q = input.value.trim().toLowerCase();
      const cards = $$('#content .card');
      cards.forEach(c => {
        const hit = !q || c.dataset.title.includes(q) || c.dataset.text.includes(q);
        c.style.display = hit ? '' : 'none';
      });
    });
  }

  function attachCopyLink() {
    const btn = document.getElementById('copyLinkBtn');
    btn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(location.href);
        btn.textContent = 'Copied!';
        setTimeout(() => (btn.textContent = 'Copy link'), 1200);
      } catch (e) {
        alert('Could not copy to clipboard.');
      }
    });
  }

  function attachExpandAll() {
    const btn = document.getElementById('expandAllBtn');
    btn.addEventListener('click', () => {
      // This example uses simple groups, so nothing collapsible to expand.
      // Kept for future: turn subtopics into accordions if you want nested collapses.
      btn.classList.toggle('active');
    });
  }

  function saveLast(cat, sub) {
    try { localStorage.setItem('lastCat', cat); localStorage.setItem('lastSub', sub); } catch {}
  }
  function loadLast() {
    try { return { cat: localStorage.getItem('lastCat'), sub: localStorage.getItem('lastSub') }; } catch { return {}; }
  }
	function clearLast() {
	  try {
		localStorage.removeItem('lastCat');
		localStorage.removeItem('lastSub');
	  } catch {}
	}
	

  /*****************************************************************
   * 6) ROUTING
   *****************************************************************/
  function navigateFromHash() {
    const { cat, sub, sec } = parseHash();
    if (cat && sub) saveLast(cat, sub);
    highlightActive(cat, sub);
    renderMain(cat, sub, sec);
  }

  function firstLoad() {
    renderSidebar(CONTENT);

    clearLast();
    const { cat, sub } = parseHash();
    if (cat && sub) {
      navigateFromHash();
    } else {
      const last = loadLast();
	  
      if (last.cat && last.sub && CONTENT[last.cat] && CONTENT[last.cat][last.sub]) {
        location.hash = hashFor(last.cat, last.sub);
      }
	  
    }

    attachFiltering();
    attachCopyLink();
    attachExpandAll();
  }

  window.addEventListener('hashchange', navigateFromHash);
  window.addEventListener('DOMContentLoaded', firstLoad);